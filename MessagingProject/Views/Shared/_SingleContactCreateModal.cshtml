<div id="createModal" class="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5);">
    <div class="modal-content" style="background:#fff; padding:20px; width:90%; max-width:50em; margin:15% auto; border-radius:8px; position:relative;">
        <span onclick="closeCreateModal()" style="cursor:pointer; position:absolute; top:0px; right:10px; font-size:35px;">&times;</span>

        @* Hidden inputs *@
        <input type="hidden" id="hiddenId" value="@Model.Id" />

        <input type="hidden" id="hiddenName" value="@Model.Name" />
        <input type="hidden" id="hiddenEmail" value="@Model.Email" />
        <input type="hidden" id="hiddenPhone" value="@Model.Phone" />

        <label class="form-controll" style="margin-top:3em;">Имя</label>
        <input type="text" id="name" class="form-control" placeholder="Имя" style="margin-bottom:1em;" />

        <label class="form-controll">Email</label>
        <input type="text" id="email" class="form-control" placeholder="Email" style="margin-bottom:1em;"  />

        <label class="form-controll">Phone</label>
        <input type="text" id="phone" class="form-control" placeholder="Phone" style="margin-bottom:1em;"  />

        <div class="d-flex justify-content-end py-4 ms-2">
            <button class="btn btn-primary d-flex me-2 align-items-center " onclick="closeCreateModal()">
                <img src="~/img/icons/close.svg" alt="close Icon" width="17" class="me-1">Закрыть
            </button>
            <button class="btn btn-success d-flex align-items-center" onclick="createContact()">
                <img src="~/img/icons/save.svg" alt="save Icon" width="22" class="me-2">Сохранить
            </button>
        </div>
    </div>
</div>
<script>


        function createContact() {
        getToken().then(function(token) {
            console.log("Токен:", token);

            if (!token) {
                alert("Ошибка: токен не получен");
                return;
            }
                var id = parseInt(document.getElementById("hiddenId").value);
                var name = document.getElementById("hiddenName").value;
                var email = parseInt(document.getElementById("hiddenEmail").value);
                var phone = parseInt(document.getElementById("hiddenPhone").value);

                var requestData = {
        request: {
            
            Name: $("#name").val().trim(),
            Email: $("#email").val().trim(),
            Phone: $("#phone").val().trim()
            
        },
        requestBody: {
            id:id,
            name: name,
            email: email,
            phone: phone,
            Token: token
        }
    };


            console.log("Данные перед отправкой:", requestData);

            $.ajax({
                url: '/Contacts/CreateSingleContact',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(requestData),
                success: function(result) {
                console.log("Контакт создан"+ result);

                    
                    closeCreateModal();
                     location.reload();
                },
                error: function(xhr) {
                    let errorMessage = xhr.responseJSON?.message || "Ошибка создания контакта";
                    alert("Ошибка: " + errorMessage);
                }
            });
        }).catch(function(error) {
            console.error("Ошибка получения токена:", error);
            alert("Ошибка: " + error);
        });
    }




        function openCreateModal() {
        document.getElementById("createModal").style.display = "block";
    }

    function closeCreateModal() {
        document.getElementById("createModal").style.display = "none";
    }

    window.onclick = function(event) {
        var modal = document.getElementById("createModal");
        if (event.target === modal) {
            closeModal();
        }
    };
</script>